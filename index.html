<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lava Jato Ã”nix</title>

<style>

body{
font-family:Arial;
margin:0;
background:white;
}

#intro{
position:fixed;
width:100%;
height:100%;
background:white;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
z-index:9999;
transition:0.5s;
}

#intro img{
width:150px;
}

#intro h2{
color:#c40000;
}

header{
display:flex;
align-items:center;
padding:15px;
box-shadow:0 3px 10px rgba(0,0,0,0.2);
}

.logo{
width:60px;
}

h1{
color:#c40000;
margin-left:10px;
}

.container{
padding:20px;
}

input,button{
width:100%;
padding:15px;
margin-top:10px;
border-radius:10px;
border:1px solid #ccc;
font-size:16px;
}

button{
background:#c40000;
color:white;
border:none;
cursor:pointer;
}

.horas button{
width:30%;
margin:5px;
background:#eee;
color:black;
}

.horas button:hover{
background:#c40000;
color:white;
}

.card{
background:#eee;
padding:15px;
margin-top:10px;
border-radius:10px;
}

.admin{
position:absolute;
right:20px;
top:20px;
font-size:25px;
cursor:pointer;
}

.labelTitulo{
font-weight:bold;
margin-top:15px;
display:block;
color:#c40000;
font-size:18px;
}

</style>

</head>
<body>

<div id="intro">
<img src="LAVA JATO.png">
<h2>Bem vindo ao Lava Jato Ã”nix</h2>
</div>

<header>
<img src="LAVA JATO.png" class="logo">
<h1>Lava Jato Ã”nix</h1>
</header>

<div class="admin" onclick="abrirAdmin()">â‹®</div>

<div class="container">

<input id="nome" placeholder="Seu nome">
<input id="carro" placeholder="Seu carro">
<input id="fone" placeholder="Telefone">

<label class="labelTitulo">
ðŸ“… Selecione o dia:
</label>

<input type="date" id="data" onchange="gerarHoras()">

<label class="labelTitulo">
ðŸ•’ HorÃ¡rios disponÃ­veis:
</label>

<div id="horas" class="horas"></div>

<button onclick="agendar()">AGENDAR</button>

<div id="lista"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import {
getFirestore,
collection,
addDoc,
getDocs
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";


const firebaseConfig = {

apiKey: "AIzaSyBzgEYfUA5TZ1QdXg85yzCbrabQaK2Ax0w",
authDomain: "lava-jato-onix.firebaseapp.com",
projectId: "lava-jato-onix",
storageBucket: "lava-jato-onix.firebasestorage.app",
messagingSenderId: "1019152811175",
appId: "1:1019152811175:web:aa54caaa90843084740782"

};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let senha="I8i82022@2023"
let horarioSelecionado=""

window.onload = function(){

setTimeout(()=>{

intro.style.opacity="0"

setTimeout(()=>{

intro.style.display="none"

},500)

},2000)

}

function converter(h){

let p=h.split(":")
return p[0]*60+parseInt(p[1])

}

function horariosFuncionamento(dataEscolhida){

let dia = new Date(dataEscolhida).getDay()

// terÃ§a fechado
if(dia==2){

return []

}

// sÃ¡bado
if(dia==6){

return [
"08:00","08:30","09:00","09:30",
"10:00","10:30","11:00","11:30",
"12:00","12:30","13:00","13:30",
"14:00","14:30","15:00","15:30",
"16:00","16:30","17:00"
]

}

// outros dias 12:30+
return [

"12:30","13:00","13:30",
"14:00","14:30","15:00","15:30",
"16:00","16:30","17:00"

]

}

window.gerarHoras = async function(){

horas.innerHTML=""
horarioSelecionado=""

let dataEscolhida=data.value

let agenda=[]

const querySnapshot = await getDocs(collection(db,"agenda"))

querySnapshot.forEach(doc => {

agenda.push(doc.data())

})

let horarios=horariosFuncionamento(dataEscolhida)

if(horarios.length==0){

horas.innerHTML="<b>Fechado neste dia</b>"
return

}

horarios.forEach(h=>{

let bloqueado=false

agenda.forEach(a=>{

if(a.data==dataEscolhida){

let dif=Math.abs(converter(h)-converter(a.hora))

if(dif<150){

bloqueado=true

}

}

})

if(!bloqueado){

horas.innerHTML+=
`<button onclick="selecionarHora('${h}')">${h}</button>`

}

})

}

window.selecionarHora=function(h){

horarioSelecionado=h

alert("Selecionado: "+h)

}

window.agendar = async function(){

if(horarioSelecionado==""){

alert("Selecione horÃ¡rio")
return

}

await addDoc(collection(db,"agenda"),{

nome:nome.value,
carro:carro.value,
fone:fone.value,
data:data.value,
hora:horarioSelecionado

})

alert("Agendado com sucesso âœ…")

gerarHoras()

}

window.abrirAdmin = async function(){

let s=prompt("Senha")

if(s!=senha){

alert("Senha errada")
return

}

let html=""

const querySnapshot = await getDocs(collection(db,"agenda"))

querySnapshot.forEach((docSnap)=>{

let a=docSnap.data()

html+=`

<div class="card">

Nome: ${a.nome}<br>
Carro: ${a.carro}<br>
Telefone: ${a.fone}<br>
Data: ${a.data}<br>
Hora: ${a.hora}<br>

</div>

`

})

lista.innerHTML=html

}

</script>

</body>
</html>
